{% from "chat/macros/search.html" import search_input %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="csrf_token" content="{{ csrf_token }}">
    <title>Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- Option 1: Include in HTML -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', path='/chat/css/loader.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/chat/css/chat.css') }}">
</head>
<body>
    <div class="container">
        <div class="row chat-container">

            <section class="side-section">
                {% include 'chat/includes/new_room_form.html' %}
                {{ search_input() }}
                <div class="rooms">
                    {% for room in rooms %}
                        <div class="room" data-name="{{ room.name }}" data-id="{{ room.id }}">
                            <div class="photo room-icon">
                                <i class="fa-solid fa-users-viewfinder"></i>
                            </div>
                            <div class="desc-contact">
                                <p class="name">{{ room.name }}</p>
                                <p class="message"></p>
                            </div>
                            <div class="options">
                                {% if request.user not in room.members and request.user != room.owner %}
                                    <form action="{{ url_for('room-subscribe', room_id=room.id) }}" id="room-subscription-form">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-transparent" id="room-subscription-btn" title="Join this room">
                                            <i class="fa-solid fa-user-plus subscribe-icon"></i>
                                        </button>
                                    </form>
                                {% endif %}
                                {% if request.user == room.owner or request.user.is_admin %}
                                    <form action="{{ url_for('room-delete', room_id=room.id) }}" id="room-delete-form">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-transparent" id="room-delete-btn" title="Delete this room">
                                            <i class="fa-solid fa-trash-can delete-icon"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                            <div class="timer">{{ room.created_at.strftime("%Y-%m-%d %H:%m:%S")}}</div>
                            {%  if room.visibility.value == "public" %}
                                <i class="bi bi-unlock-fill visibility" title="This room is public"></i>
                            {% else %}
                                <i class="bi bi-lock-fill visibility" title="This room is private"></i>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-primary new-room" id="new-room"><i class="bi bi-plus-circle-fill"></i></button>
            </section>
            <section class="chat">
                <!-- Chat header -->
                <div class="header-chat">
                    <i class="fa-solid fa-users-rays icon"></i>
                    <p class="name">SÃ©phora LEIB</p>
                    <i class="icon clickable fa fa-ellipsis-h right" aria-hidden="true"></i>
                </div>
                <!-- Chat body -->
                <div class="messages-chat" id="room-conversation">
                </div>
                <!-- Chat footer -->
                <div class="footer-chat">
                    <i class="icon fa fa-smile-o clickable" style="font-size:25pt;" aria-hidden="true"></i>
                    <form class="form" id="message-form">
                        <div class="form-group">
                            <input type="text" class="write-message" id="message" placeholder="Type your message here"></input>
                            <button class="send-message" type="submit">
                                <i class="icon send fa fa-paper-plane clickable" aria-hidden="true"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </div>

    <script src="{{ url_for('static', path='/chat/js/init-websocket.js' )}}" data-ws-url="{{ url_for('websocket-connect') }}"></script>
    <script src="{{ url_for('static', path='/chat/js/filter-rooms.js' )}}"></script>
    <script src="{{ url_for('static', path='/chat/js/utils.js' )}}" data-api-url="{{ url_for('room-create').path }}"></script>
    <script src="{{ url_for('static', path='/chat/js/new-rooms.js' )}}" data-api-create="{{ url_for('room-create').path }}" data-api-delete="{{ url_for('room-delete', room_id=-1) }}"></script>
    <script src="{{ url_for('static', path='/chat/js/new-messages.js') }}" data-current-user-id="{{request.user.id}}"></script>
    <script src="{{ url_for('static', path='/chat/js/room-events.js') }}" data-room-conversation="{{url_for('room-messages', room_id=-1).path}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>
