<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
</head>
<body>
    <h1>Chat application</h1>

    <strong>Your ID: <span id="user-id"></span></strong>

    <form  onsubmit="sendMessage(event)">
        <div class="form-group">
            <label for="messageTest">Message: </label>
            <input type="text" id="messageTest" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>

    <ul id="messages"></ul>

    <script type="text/javascript">

        const channelName = "Bar"
        const clientId = Date.now()

        document.getElementById("user-id").textContent = clientId
        const ws = new WebSocket(`ws://localhost:8000/chat/${channelName}/`)

        ws.onmessage = function (event) {
            const messages = document.getElementById("messages")
            const message  = document.createElement("li")
            const content = document.createTextNode(event.data)
            message.appendChild(content)
            messages.appendChild(message)
        }

        function sendMessage(e) {
            e.preventDefault()
            e.stopPropagation()

            const input = document.getElementById("messageTest")
            ws.send(input.value)
            input.value = ""
        }

    </script>

</body>
</html>
